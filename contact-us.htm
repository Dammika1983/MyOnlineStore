<!--
  -- Student Name: Dammika Pathirana
  -- Student ID: 041089481
  -- Course: CST8117 - Cross-Platform Web Design
  -- Semester: 23W
  -- Assignment: 4
  -- Date Submitted:  16/04/2023
  -->

  <!DOCTYPE html>
  <html lang="en-ca"> <!--initiate the language---->
	<head>
		<!--Include the Title of the Website-->
		<title>Super20</title>
		<!-- Jquery and Bootstrap -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js" integrity="sha512-aVKKRRi/Q/YV+4mjoKBsE4x3H+BkegoM/em46NNlCqNTmUYADjBbeNefNxYV7giUp0VxICtqdrbqU7iVaeZNXA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    	<script type='text/javascript' src="https://rawgit.com/RobinHerbots/jquery.inputmask/3.x/dist/jquery.inputmask.bundle.js"></script>
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
		<!--Link the main.css fie-->
		<link rel="stylesheet" href="assets/products.css">
		<link rel="stylesheet" href="assets/main.css">
		<link rel="stylesheet" href="assets/contact-us.css">
		<!--Decalare the meta type and content-->
		<meta type="keywords" content="Super20, online store">
		<!--Add the viewport meta tag to the head section of every page on your website, with the device-width value and initial scaling set to 1.-->
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<nav>
			<li>
				<a href="index.htm">Home</a>
			</li>
		</nav> 
	</head>
	<body>
		<div class="container">
			<div class="row">
				<div class="col-md-12">
					<h1 class="text-center">Please fill your details</h1>	
				</div>
			</div>

			<div class="row">
				<div class="form-cotainer mt-3">
					<form id="contact-form">
						<div class="form-group">
						  	<label for="user_name">Name</label>
						  	<input type="text" class="form-control" id="user_name" name="user_name">
						  	<small id="user_name_error" class="form-text input-error"></small>
						</div>

						<div class="form-group">
							<label for="user_phone">Phone</label>
							<input type="text" class="form-control" id="user_phone" name="user_phone">
							<small id="user_phone_error" class="form-text input-error"></small>
						</div>

						<div class="form-group">
							<label for="user_email">Email</label>
							<input type="text" class="form-control" id="user_email" name="user_email">
							<small id="user_email_error" class="form-text input-error"></small>
						</div>

						<div class="form-group">
							<label for="user_confirm_email">Confirm Email</label>
							<input type="text" class="form-control" id="user_confirm_email" name="user_confirm_email">
							<small id="user_confirm_email_error" class="form-text input-error"></small>
						</div>

						<div class="form-group">
							<label for="user_dob">Date of Birth</label>
							<input type="text" class="form-control" id="user_dob" name="user_dob" data-inputmask="'alias': 'date'">
							<small id="user_dob_error" class="form-text input-error"></small>
						</div>

						<div class="form-group">
							<label for="user_comment">Comments</label>
							<textarea class="form-control" id="user_comment" name="user_comment" rows="3"></textarea>
							<small id="user_comment_error" class="form-text input-error"></small>
						</div>

                        <div class="form-group form-check">
                            <input type="checkbox" class="form-check-input" id="consent_checkbox">
                            <a target="_blank" href="./terms.htm" class="form-check-label">I agree to the Terms & Conditions of this page.</a>
                            <small id="consent_error" class="form-text input-error"></small>
                        </div>
                        
                        <div class="form-group form-check">
                            <button type="button" class="btn btn-warning p-2" id="btn_reset">Reset</button>
                            <button type="submit" class="btn btn-success float-right p-2">Submit</button>
                        </div>

                        <div class="form-group form-check" id="form-success">
                            <div class="alert alert-success" role="alert">
                                Form data successfully submitted.
                            </div>
                        </div>
					</form>
				</div>
								  
			</div>
		</div>
	
		<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
		
		<script type="text/javascript">
			$(document).ready(function(){
                $('#form-success').hide();

				$('#user_dob').inputmask({
					placeholder: "dd-mm-yyyy"
				});
                
                $("#user_phone").inputmask({
                    mask: '999-999-9999',
                    placeholder: '',
                });
			});

            function isValidEmail (email){
                if(!email) return false;
                if(typeof(email) !== "string") return false;
                if(/^\d$/.test(email[0])) return false;
                
                var reg = /^([\w-]+(?:\.[\w-]+)*)@(?:\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])?([a-zA-Z-]+\.[a-zA-Z]{2,})$/;
                if (reg.test(email)){
                    return true;
                } else {
                    return false;
                }
            }

            function isAgeOfMajority (birthYear, birthMonth, birthDay) {
                if(typeof(birthYear) !== "number" || typeof(birthMonth) !== "number" || typeof(birthDay) !== "number") {
                    return false;
                }

                if(birthYear < 1920 || birthYear > 2010) {
                    return false;
                }

                if(birthMonth < 1 || birthMonth > 12) {
                    return false;
                }

                if(birthDay < 1 || birthDay > 31) {
                    return false;
                }
            
                if (!((0 == birthYear % 4) && (0 != birthYear % 100) || (0 == birthYear % 400))) {
                if(birthMonth === 2 && birthDay > 28) {
                    return false;
                }
                }
                
                const dateConcat = birthMonth+"/"+birthDay+"/"+birthYear;
                const dateGiven = new Date(dateConcat);
                const dateToday = new Date();
            
                const diffTime = Math.abs(dateToday - dateGiven);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                if(diffDays > 6570) {
                return true;
                } else {
                return false;
                }
            }

            $('#contact-form').on('submit', function(e) {
                e.preventDefault();
                const userName = $('#user_name').val();
                const userPhone = $('#user_phone').val();
                const userEmail = $('#user_email').val();
                const userConfirmEmail = $('#user_confirm_email').val();
                const userDob = $('#user_dob').val();
                const userComment = $('#user_comment').val();
                const consentCheck = $('#consent_checkbox').is(":checked");
                
                let nameValidation = true;
                let phoneValidation = true;
                let emailValidation = true;
                let confirmEmailValidation = true;
                let dobValidation = true;
                let commentValidation = true;

                //Name validation
                if(userName === "" || userName === null) {
                    nameValidation = false;
                    $('#user_name_error').text("Name is required.");
                } else {
                    nameValidation = true;
                    $('#user_name_error').text("");
                }

                //Phone validation
                if(userPhone === "" || userPhone === null) {
                    phoneValidation = false;
                    $('#user_phone_error').text("Phone number is required.");
                } else {
                    const phoneNumbersOnly = userPhone.replace(/-/g, "");
                    if(phoneNumbersOnly.length < 10) {
                        phoneValidation = false;
                        $('#user_phone_error').text("Phone number should have 10 numbers.");                    
                    } else {
                        phoneValidation = true;
                        $('#user_phone_error').text("");                    
                    }
                }

                //Email validation
                if(userEmail === "" || userEmail === null) {
                    emailValidation = false;
                    $('#user_email_error').text("Email is required.")
                } else if(!isValidEmail(userEmail)) {
                    emailValidation = false;
                    $('#user_email_error').text("Invalid email address.")
                } else {
                    emailValidation = true;
                    $('#user_email_error').text("");
                }

                //Confirm email validation
                if(userConfirmEmail === "" || userConfirmEmail === null) {
                    confirmEmailValidation = false;
                    $('#user_confirm_email_error').text("Email confirmation is required.");
                } else if(userConfirmEmail !== userEmail) {
                    confirmEmailValidation = false;
                    $('#user_confirm_email_error').text("Email confirmation failed.");
                } else {
                    confirmEmailValidation = true;
                    $('#user_confirm_email_error').text("");
                }

                //DOB validation
                if(userDob === "" || userDob === null) {
                    dobValidation = false;
                    $('#user_dob_error').text("Date of birth is required.")
                } else {
                    const dobNumbersOnly = userDob.replace(/\//g, "").replace(/[^0-9]/g,"");
                    if(dobNumbersOnly.length < 8) {
                        dobValidation = false;
                        $('#user_dob_error').text("Invalid date of birth.");                    
                    } else {
                        const userDobArr = userDob.split("/");
                        if(!isAgeOfMajority(Number(userDobArr[2]), Number(userDobArr[1]), Number(userDobArr[0]))) {
                            dobValidation = false;
                            $('#user_dob_error').text("User is not adult.");                    
                        } else {
                            dobValidation = true;
                            $('#user_dob_error').text("");        
                        }
                    }
                }

                //Comment validation
                if(userComment === "" || userComment === null) {
                    commentValidation = false;
                    $('#user_comment_error').text("Comment is required.");
                } else if(userComment.length < 3) {
                    commentValidation = false;
                    $('#user_comment_error').text("Comment must be at least 3 characters long.");
                } else {
                    commentValidation = true;
                    $('#user_comment_error').text("");
                }

                //Consent check
                if(!consentCheck) {
                    $('#consent_error').text("You must agree to the Terms and Conditions to continue.");
                } else {
                    $('#consent_error').text("");
                }

                if(nameValidation &&
                phoneValidation &&
                emailValidation &&
                confirmEmailValidation &&
                dobValidation &&
                commentValidation &&
                consentCheck) {
                    $('#form-success').show();
                    $('#btn_reset').trigger("click");
                    window.setTimeout(function () {
                        $('#form-success').hide();
                    }, 2000);
                }
            });

            $('#btn_reset').on('click', function () {
                $('#user_name').val("");
                $('#user_phone').val("");
                $('#user_email').val("");
                $('#user_confirm_email').val("");
                $('#user_dob').val("");
                $('#user_comment').val("");
                $('#consent_checkbox').prop("checked", false);
            });
		</script>
	</body>
</html>